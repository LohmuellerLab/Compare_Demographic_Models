#!/bin/bash/
# November 28, 2016
# Author: Beichman, Annabel  annabel.beichman@gmail.com
# Contact: annabel.beichman@gmail.com
# Purpose: code to simulate 80 x 30Mbp independent segments of 
# genetic sequence in MaCS (Chen et al. 2008) 
# under stepwise versions of the 2-Haplotype models of CEU, CHB and YRI demography 
# inferred using MSMC by Schiffels & Durbin (2014)
# This is a control to ensure that MSMC can properly re-infer 
# its own demographies from simulated sequence data

#!/bin/bash/
# make sure python3 is available
# Requires ms2multihetsep.py https://github.com/stschiff/msmc-tools/blob/master/ms2multihetsep.py
# and 
# msformatter https://github.com/gchen98/macs
# sequence length: (30Mb)
seqLength=30000000
# Path to recombination rate file (relative to average recombination rate)
recRatesFile=[/path/to/recRates/file]
thetaYRI=0.002055021135
recYRI=0.0015220071795829248

thetaCHB=0.0020563142199999996
recCHB=0.0015229648751609855

thetaCEU=0.0020630637299999996
recCEU=0.0015279637544930301
model="MSMCmodel" 
for j in {1..10}
do
	mkdir $j.${model}
	cd $j.${model}
	cp ../macs ./
     cp ../ms2multihetsep.py ./
     cp ../msformatter ./
	mkdir africanSample
	mkdir europeanSample
	mkdir asianSample
	for i in {1..80}
	do 
	# sample YRI
 	./macs 2 $seqLength -t $thetaYRI -r $recYRI -R ${recRatesFile}/${i}.300blocks.RATIOS.MACS.txt -eN 0.0 0.422989094952 -eN 0.00449572991861 0.399823345369 -eN 0.00910822749276 0.342935168888 -eN 0.0138437992269 0.273205418882 -eN 0.0187090533256 0.330804215792 -eN 0.0237114349678 0.459793259012 -eN 0.0288587786227 0.591321203127 -eN 0.0341598433244 0.698800180466 -eN 0.0396240207038 0.759929101654 -eN 0.0452616756178 0.786153026596 -eN 0.0510841461492 0.800468818536 -eN 0.0571040355748 0.809133688058 -eN 0.0633356016555 0.803197187069 -eN 0.0697934427813 0.803197187069 -eN 0.0764950770202 0.762327967493 -eN 0.0834594822792 0.762327967493 -eN 0.0907080695304 0.694338141199 -eN 0.0982656560367 0.694338141199 -eN 0.106159005513 0.614806251129 -eN 0.114419747805 0.614806251129 -eN 0.12308340566 0.538828142028 -eN 0.132191827798 0.538828142028 -eN 0.141792702293 0.475041002437 -eN 0.151941989638 0.475041002437 -eN 0.162707329042 0.425139897649 -eN 0.17416755181 0.425139897649 -eN 0.186419007316 0.387520206696 -eN 0.199578482681 0.387520206696 -eN 0.213791475191 0.359854316048 -eN 0.229242411174 0.359854316048 -eN 0.246166811321 0.340571032619 -eN 0.264876107953 0.340571032619 -eN 0.285790734702 0.330385336889 -eN 0.309502412976 0.330385336889 -eN 0.336874880851 0.339590631509 -eN 0.369250216981 0.339590631509 -eN 0.408874140363 0.451167060625 -eN 0.459958773125 0.451167060625 -eN 0.531955599571 1.0 -eN 0.655039491844 1.0 | ./msformatter | python3 $scriptDir/ms2multihetsep.py $i $seqLength > africanSample/${i}.af.macs.msmcFormat.OutputFile.txt
	# sample CHB
	./macs 2 $seqLength -t $thetaCHB -r $recCHB -R ${recRatesFile}/${i}.300blocks.RATIOS.MACS.txt -eN 0.0 1.48534453796 -eN 0.00429269997462 0.124530615268 -eN 0.00869691987054 0.0554363427978 -eN 0.0132186023593 0.0800742602461 -eN 0.0178641472411 0.119750553006 -eN 0.0226406059673 0.18753885289 -eN 0.0275555162965 0.29033860399 -eN 0.0326171454477 0.413464832724 -eN 0.0378345873618 0.5330560132 -eN 0.0432176168096 0.629442143332 -eN 0.048777078437 0.698481117832 -eN 0.0545252271805 0.745658056579 -eN 0.0604751933292 0.780764537046 -eN 0.0666415660929 0.780764537046 -eN 0.0730403936029 0.766350708794 -eN 0.079690155525 0.766350708794 -eN 0.0866117630602 0.700614451813 -eN 0.0938280726377 0.700614451813 -eN 0.101364858528 0.620602217593 -eN 0.109252271766 0.620602217593 -eN 0.117524840148 0.547045458354 -eN 0.126221954542 0.547045458354 -eN 0.135388841497 0.486871770502 -eN 0.145080453706 0.486871770502 -eN 0.155359524771 0.440435630504 -eN 0.166301918585 0.440435630504 -eN 0.178000033477 0.405164671283 -eN 0.190565233751 0.405164671283 -eN 0.204136603208 0.377717107846 -eN 0.218889698676 0.377717107846 -eN 0.235049680296 0.35607061308 -eN 0.252913681645 0.35607061308 -eN 0.27288436492 0.341734508844 -eN 0.295524873626 0.341734508844 -eN 0.321661443357 0.34745148774 -eN 0.352574520445 0.34745148774 -eN 0.390409205068 0.459122366036 -eN 0.439186283505 0.459122366036 -eN 0.507933072602 1.0 -eN 0.625458885364 1.0 |./msformatter| python3 $scriptDir/ms2multihetsep.py $i $seqLength > asianSample/${i}.asn.macs.msmcFormat.OutputFile.txt
	# sample european
	./macs 2 $seqLength -t $thetaCEU -r $recCEU -R ${recRatesFile}/${i}.300blocks.RATIOS.MACS.txt -eN 0.0 0.498992166374 -eN 0.00452325338491 0.139857492429 -eN 0.00916399223402 0.0726285973725 -eN 0.013928508161 0.090018942362 -eN 0.0188236065786 0.134296214882 -eN 0.0238565582266 0.220916406203 -eN 0.0290354578625 0.339316977862 -eN 0.0343689334309 0.460238230256 -eN 0.0398665823086 0.563747805309 -eN 0.0455387774182 0.646757977273 -eN 0.0513968611139 0.712618533602 -eN 0.0574538722563 0.758198029588 -eN 0.0637231890069 0.777006372459 -eN 0.0702203222777 0.777006372459 -eN 0.0769632065608 0.737165800011 -eN 0.0839702610641 0.737165800011 -eN 0.0912637827238 0.663258577572 -eN 0.0988670379077 0.663258577572 -eN 0.106809109576 0.587385029545 -eN 0.115120050121 0.587385029545 -eN 0.123836697958 0.521881813123 -eN 0.133000738664 0.521881813123 -eN 0.142660643838 0.468881860475 -eN 0.15287215582 0.468881860475 -eN 0.163703619568 0.426991077488 -eN 0.175234043788 0.426991077488 -eN 0.187559886965 0.393983556194 -eN 0.200799904519 0.393983556194 -eN 0.215100480682 0.368571689736 -eN 0.230645807534 0.368571689736 -eN 0.247673880632 0.350544929603 -eN 0.266497341796 0.350544929603 -eN 0.287540317526 0.340955516677 -eN 0.311397069639 0.340955516677 -eN 0.33893717864 0.35015368866 -eN 0.37151057859 0.35015368866 -eN 0.4113775002 0.4617970139 -eN 0.462774361314 0.4617970139 -eN 0.535213713442 1.0 -eN 0.659048957252 1.0 | ./msformatter| python3 $scriptDir/ms2multihetsep.py $i $seqLength > europeanSample/${i}.eur.macs.msmcFormat.OutputFile.txt
	done
cd ../
done