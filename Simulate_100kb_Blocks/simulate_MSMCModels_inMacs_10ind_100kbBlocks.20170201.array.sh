#! /bin/bash
#$ -l h_rt=24:00:00,h_data=28G
#$ -N msmcsim
#$ -o output.txt
#$ -e error.txt
#$ -m abe
#$ -M ab08028
#$ -t 1-200

# November 28, 2016
# Author: Beichman, Annabel  annabel.beichman@gmail.com
# Contact: annabel.beichman@gmail.com
# This script simulates 20,000 x 100kb windows across 10 individuals under the MSMC 2, 4 and 8 haplotype models for CEU, CHB and YRI

j=$SGE_TASK_ID
rundate=`date +%Y%m%d`
model=MSMC_inMACS_model_100kb_10ind
recRatesFile=allChrRecRates_Mperbp_100kbWindows.forMACS.20170201.txt
mkdir group_$j.${model}
cd group_$j.${model}
cp ../macs ./
cp ../msformatter ./
mkdir africanSample
mkdir europeanSample
mkdir asianSample
for i in {1..100}
do
window=$((((${j}-1)*100)+$i))
r=`awk -v window=$window '{if(NR==window) print}' $recRatesFile`
# MSMC YRI-2-Hap maCS model
NaYRI_2=41100
# Ancestral size: 41100
ri=`bc <<< "${r}*${NaYRI_2}*4"`
./macs 20 100000 -t 0.002055 -r $ri -eN 0.0 0.422989094952 -eN 0.00449572991861 0.399823345369 -eN 0.00910822749276 0.342935168888 -eN 0.0138437992269 0.273205418882 -eN 0.0187090533256 0.330804215792 -eN 0.0237114349678 0.459793259012 -eN 0.0288587786227 0.591321203127 -eN 0.0341598433244 0.698800180466 -eN 0.0396240207038 0.759929101654 -eN 0.0452616756178 0.786153026596 -eN 0.0510841461492 0.800468818536 -eN 0.0571040355748 0.809133688058 -eN 0.0633356016555 0.803197187069 -eN 0.0697934427813 0.803197187069 -eN 0.0764950770202 0.762327967493 -eN 0.0834594822792 0.762327967493 -eN 0.0907080695304 0.694338141199 -eN 0.0982656560367 0.694338141199 -eN 0.106159005513 0.614806251129 -eN 0.114419747805 0.614806251129 -eN 0.12308340566 0.538828142028 -eN 0.132191827798 0.538828142028 -eN 0.141792702293 0.475041002437 -eN 0.151941989638 0.475041002437 -eN 0.162707329042 0.425139897649 -eN 0.17416755181 0.425139897649 -eN 0.186419007316 0.387520206696 -eN 0.199578482681 0.387520206696 -eN 0.213791475191 0.359854316048 -eN 0.229242411174 0.359854316048 -eN 0.246166811321 0.340571032619 -eN 0.264876107953 0.340571032619 -eN 0.285790734702 0.330385336889 -eN 0.309502412976 0.330385336889 -eN 0.336874880851 0.339590631509 -eN 0.369250216981 0.339590631509 -eN 0.408874140363 0.451167060625 -eN 0.459958773125 0.451167060625 -eN 0.531955599571 1.0 -eN 0.655039491844 1.0  > africanSample/group_${j}_block_${i}.msmc.yri_2.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < africanSample/group_${j}_block_${i}.msmc.yri_2.macs.macsFormat.OutputFile.${rundate}.txt > africanSample/group_${j}_block_${i}.msmc.yri_2.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CEU 2-Hap maCS model
NaCEU_2=41261
# Ancestral size: 41261
ri=`bc <<< "${r}*${NaCEU_2}*4"`
./macs 20 100000 -t 0.00206305 -r $ri -eN 0.0 0.498992166374 -eN 0.00452325338491 0.139857492429 -eN 0.00916399223402 0.0726285973725 -eN 0.013928508161 0.090018942362 -eN 0.0188236065786 0.134296214882 -eN 0.0238565582266 0.220916406203 -eN 0.0290354578625 0.339316977862 -eN 0.0343689334309 0.460238230256 -eN 0.0398665823086 0.563747805309 -eN 0.0455387774182 0.646757977273 -eN 0.0513968611139 0.712618533602 -eN 0.0574538722563 0.758198029588 -eN 0.0637231890069 0.777006372459 -eN 0.0702203222777 0.777006372459 -eN 0.0769632065608 0.737165800011 -eN 0.0839702610641 0.737165800011 -eN 0.0912637827238 0.663258577572 -eN 0.0988670379077 0.663258577572 -eN 0.106809109576 0.587385029545 -eN 0.115120050121 0.587385029545 -eN 0.123836697958 0.521881813123 -eN 0.133000738664 0.521881813123 -eN 0.142660643838 0.468881860475 -eN 0.15287215582 0.468881860475 -eN 0.163703619568 0.426991077488 -eN 0.175234043788 0.426991077488 -eN 0.187559886965 0.393983556194 -eN 0.200799904519 0.393983556194 -eN 0.215100480682 0.368571689736 -eN 0.230645807534 0.368571689736 -eN 0.247673880632 0.350544929603 -eN 0.266497341796 0.350544929603 -eN 0.287540317526 0.340955516677 -eN 0.311397069639 0.340955516677 -eN 0.33893717864 0.35015368866 -eN 0.37151057859 0.35015368866 -eN 0.4113775002 0.4617970139 -eN 0.462774361314 0.4617970139 -eN 0.535213713442 1.0 -eN 0.659048957252 1.0  > europeanSample/group_${j}_block_${i}.msmc.ceu_2.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < europeanSample/group_${j}_block_${i}.msmc.ceu_2.macs.macsFormat.OutputFile.${rundate}.txt > europeanSample/group_${j}_block_${i}.msmc.ceu_2.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CHB 2-Hap maCS model
NaCHB_2=41126
# Ancestral size: 41126
ri=`bc <<< "${r}*${NaCHB_2}*4"`
./macs 20 100000 -t 0.0020563 -r $ri -eN 0.0 1.48534453796 -eN 0.00429269997462 0.124530615268 -eN 0.00869691987054 0.0554363427978 -eN 0.0132186023593 0.0800742602461 -eN 0.0178641472411 0.119750553006 -eN 0.0226406059673 0.18753885289 -eN 0.0275555162965 0.29033860399 -eN 0.0326171454477 0.413464832724 -eN 0.0378345873618 0.5330560132 -eN 0.0432176168096 0.629442143332 -eN 0.048777078437 0.698481117832 -eN 0.0545252271805 0.745658056579 -eN 0.0604751933292 0.780764537046 -eN 0.0666415660929 0.780764537046 -eN 0.0730403936029 0.766350708794 -eN 0.079690155525 0.766350708794 -eN 0.0866117630602 0.700614451813 -eN 0.0938280726377 0.700614451813 -eN 0.101364858528 0.620602217593 -eN 0.109252271766 0.620602217593 -eN 0.117524840148 0.547045458354 -eN 0.126221954542 0.547045458354 -eN 0.135388841497 0.486871770502 -eN 0.145080453706 0.486871770502 -eN 0.155359524771 0.440435630504 -eN 0.166301918585 0.440435630504 -eN 0.178000033477 0.405164671283 -eN 0.190565233751 0.405164671283 -eN 0.204136603208 0.377717107846 -eN 0.218889698676 0.377717107846 -eN 0.235049680296 0.35607061308 -eN 0.252913681645 0.35607061308 -eN 0.27288436492 0.341734508844 -eN 0.295524873626 0.341734508844 -eN 0.321661443357 0.34745148774 -eN 0.352574520445 0.34745148774 -eN 0.390409205068 0.459122366036 -eN 0.439186283505 0.459122366036 -eN 0.507933072602 1.0 -eN 0.625458885364 1.0  > asianSample/group_${j}_block_${i}.msmc.chb_2.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < asianSample/group_${j}_block_${i}.msmc.chb_2.macs.macsFormat.OutputFile.${rundate}.txt > asianSample/group_${j}_block_${i}.msmc.chb_2.macs.msFormat.OutputFile.${rundate}.txt
# MSMC YRI 4-Hap maCS model
# Ancestral size: 205845
NaYRI_4=205845
ri=`bc <<< "${r}*${NaYRI_4}*4"`
./macs 20 100000 -t 0.01029225 -r $ri -eN 0.0 0.178883365358 -eN 0.000203092649903 0.0575969008179 -eN 0.000411461114955 0.0521392769981 -eN 0.000625386189001 0.064574347071 -eN 0.000845173927616 0.0697440959887 -eN 0.0010711556481 0.0693671598858 -eN 0.00130368015666 0.0679185206354 -eN 0.00154315164097 0.0658132974452 -eN 0.00178999760722 0.0633037534652 -eN 0.00204467470978 0.0607279693428 -eN 0.00230770761533 0.0614013022953 -eN 0.00257965985478 0.0624912769607 -eN 0.00286115325533 0.065466961556 -eN 0.00315287765652 0.065466961556 -eN 0.00345562005842 0.0736069968315 -eN 0.00377024518946 0.0736069968315 -eN 0.00409770522255 0.0866089338101 -eN 0.00443910778739 0.0866089338101 -eN 0.00479568682233 0.101394215331 -eN 0.00516886087066 0.101394215331 -eN 0.00556024279669 0.119314155943 -eN 0.00597169808201 0.119314155943 -eN 0.00640541283788 0.137231375574 -eN 0.00686392295335 0.137231375574 -eN 0.00735024040391 0.153978605469 -eN 0.00786795041201 0.153978605469 -eN 0.00842138633596 0.164716503133 -eN 0.00901586285511 0.164716503133 -eN 0.00965794801924 0.169941230805 -eN 0.0103559490511 0.169941230805 -eN 0.0111205050255 0.170368844368 -eN 0.0119656070543 0.170368844368 -eN 0.0129104929166 0.162734276877 -eN 0.0139815902684 0.162734276877 -eN 0.0152181519517 0.140516013071 -eN 0.016680708958 0.140516013071 -eN 0.0184706968491 0.109638452328 -eN 0.0207784530447 0.109638452328 -eN 0.0240309979421 1.0 -eN 0.0295912018746 1.0 > africanSample/group_${j}_block_${i}.msmc.yri_4.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < africanSample/group_${j}_block_${i}.msmc.yri_4.macs.macsFormat.OutputFile.${rundate}.txt > africanSample/group_${j}_block_${i}.msmc.yri_4.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CEU 4-Hap maCS model
NaCEU_4=191238
# Ancestral size: 191238
ri=`bc <<< "${r}*${NaCEU_4}*4"`
./macs 20 100000 -t 0.0095619 -r $ri -eN 0.0 3.20691479272 -eN 0.00016255311712 0.0759344639005 -eN 0.000329329235212 0.0695064566477 -eN 0.000500553204499 0.0748256024659 -eN 0.000676468699878 0.0594804494301 -eN 0.000857340312543 0.0394248457578 -eN 0.00104345564162 0.0295994870374 -eN 0.00123512843161 0.0246464983067 -eN 0.00143269334331 0.0214138287127 -eN 0.00163654360316 0.0186679342335 -eN 0.00184706616271 0.0175662418607 -eN 0.00206473163871 0.0171857822072 -eN 0.00229004202237 0.0176308005435 -eN 0.00252354113748 0.0176308005435 -eN 0.00276584601489 0.0200845968016 -eN 0.0030176678088 0.0200845968016 -eN 0.00327975950601 0.0244198958186 -eN 0.00355302050743 0.0244198958186 -eN 0.003838423421 0.0302816606581 -eN 0.00413710818508 0.0302816606581 -eN 0.0044503611521 0.0390959609939 -eN 0.00477968829569 0.0390959609939 -eN 0.00512683612687 0.051384078084 -eN 0.00549381261046 0.051384078084 -eN 0.00588305449541 0.0677567323307 -eN 0.00629742731481 0.0677567323307 -eN 0.00674040317447 0.0862286039657 -eN 0.00721620716699 0.0862286039657 -eN 0.00773013111627 0.106616271679 -eN 0.00828878457311 0.106616271679 -eN 0.00890072230421 0.128644442975 -eN 0.00957719727898 0.128644442975 -eN 0.0103334261057 0.14842150062 -eN 0.0111907434103 0.14842150062 -eN 0.0121805027265 0.153337438739 -eN 0.0133510834563 0.153337438739 -eN 0.0147837454252 0.133959485015 -eN 0.0166308638786 0.133959485015 -eN 0.0192341065773 1.0 -eN 0.0236844677294 1.0  > europeanSample/group_${j}_block_${i}.msmc.ceu_4.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < europeanSample/group_${j}_block_${i}.msmc.ceu_4.macs.macsFormat.OutputFile.${rundate}.txt > europeanSample/group_${j}_block_${i}.msmc.ceu_4.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CHB 4-Hap maCS model
# Ancestral size: 187513
NaCHB_4=187513
ri=`bc <<< "${r}*${NaCHB_4}*4"`
./macs 20 100000 -t 0.00937565 -r $ri -eN 0.0 8.23062320734 -eN 0.000155678409836 0.257027289678 -eN 0.000315401328952 0.340314537124 -eN 0.00047938420853 0.135487312905 -eN 0.000647859565188 0.0615842533239 -eN 0.000821081247347 0.0337714439753 -eN 0.000999325501816 0.0233780070555 -eN 0.0011828909738 0.0187884126889 -eN 0.00137210403983 0.0164059220757 -eN 0.00156732200756 0.0146967878616 -eN 0.00176895018119 0.014431807975 -eN 0.00197741519673 0.0146409060117 -eN 0.00219318635376 0.0155619102099 -eN 0.0024168076132 0.0155619102099 -eN 0.00264887626544 0.0177690960907 -eN 0.00289004293038 0.0177690960907 -eN 0.00314105422102 0.0209166053144 -eN 0.00340275274347 0.0209166053144 -eN 0.00367608776281 0.0246404448448 -eN 0.00396213653496 0.0246404448448 -eN 0.00426214697021 0.0313048762055 -eN 0.00457754829916 0.0313048762055 -eN 0.00491000440222 0.0420885026784 -eN 0.00526147780498 0.0420885026784 -eN 0.00563425101004 0.0585229752352 -eN 0.0060310971514 0.0585229752352 -eN 0.00645533332397 0.0788539234466 -eN 0.00691102323565 0.0788539234466 -eN 0.00740320119123 0.10309251451 -eN 0.00793823473302 0.10309251451 -eN 0.00852429394042 0.131273423266 -eN 0.00917215137243 0.131273423266 -eN 0.00989639798025 0.154082517082 -eN 0.0107175229578 0.154082517082 -eN 0.0116654014909 0.16047634816 -eN 0.0127864942401 0.16047634816 -eN 0.0141585556164 0.144676320133 -eN 0.0159274951316 0.144676320133 -eN 0.0184206492571 1.0 -eN 0.0226828495568 1.0  > asianSample/group_${j}_block_${i}.msmc.chb_4.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < asianSample/group_${j}_block_${i}.msmc.chb_4.macs.macsFormat.OutputFile.${rundate}.txt > asianSample/group_${j}_block_${i}.msmc.chb_4.macs.msFormat.OutputFile.${rundate}.txt
# MSMC YRI 8-Hap maCS model
# Ancestral size: 132017
NaYRI_8=132017
ri=`bc <<< "${r}*${NaYRI_8}*4"`
./macs 20 100000 -t 0.00660085 -r $ri -eN 0.0 8.04813068673 -eN 9.36378596545e-05 0.408331806121 -eN 0.000190562273533 0.155396450871 -eN 0.00029101169634 0.0995799781732 -eN 0.000395251549068 0.0809331869394 -eN 0.000503581793795 0.0742703905865 -eN 0.000616334206763 0.0734506472454 -eN 0.000733886013011 0.0763188649601 -eN 0.00085666443126 0.0809375106353 -eN 0.000985154248709 0.0855513266179 -eN 0.00111991600056 0.090953627772 -eN 0.00126159051489 0.090953627772 -eN 0.0014109276969 0.0955440005062 -eN 0.00156880167851 0.0955440005062 -eN 0.00173625020732 0.0977031101361 -eN 0.00191451555053 0.0977031101361 -eN 0.00210506721935 0.0975989384566 -eN 0.00230975346496 0.0975989384566 -eN 0.00253084672738 0.0962380415562 -eN 0.00277117998179 0.0962380415562 -eN 0.00303441943141 0.0959767874617 -eN 0.00332544324743 0.0959767874617 -eN 0.00365076575786 0.0980674065075 -eN 0.00401958276988 0.0980674065075 -eN 0.00444534712831 0.105507056926 -eN 0.00494893498195 0.105507056926 -eN 0.00556526615879 0.126618079824 -eN 0.00635986267884 0.126618079824 -eN 0.00747978170932 1.0 -eN 0.00939428211026 1.0  > africanSample/group_${j}_block_${i}.msmc.yri_8.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < africanSample/group_${j}_block_${i}.msmc.yri_8.macs.macsFormat.OutputFile.${rundate}.txt > africanSample/group_${j}_block_${i}.msmc.yri_8.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CEU 8-Hap maCS model
# Ancestral size: 4037
NaCEU_8=4037
ri=`bc <<< "${r}*${NaCEU_8}*4"`
./macs 20 100000 -t 0.00020185 -r $ri -eN 0.0 1011.77533721 -eN 0.0021561331567 6.35034309855 -eN 0.00438793540727 2.73191223386 -eN 0.00670091644479 2.78062054652 -eN 0.00910120035253 3.09214473597 -eN 0.0115956246992 3.3126474583 -eN 0.0141919189104 3.37672972218 -eN 0.0168987042683 3.23104558441 -eN 0.0197257911977 2.89904624587 -eN 0.0226844765513 2.49034846207 -eN 0.0257875436096 1.91985428051 -eN 0.0290497575574 1.91985428051 -eN 0.0324884105068 1.39700170134 -eN 0.0361237178784 1.39700170134 -eN 0.0399794129724 1.08333324043 -eN 0.044084035206 1.08333324043 -eN 0.0484719706133 0.931485926314 -eN 0.0531853842014 0.931485926314 -eN 0.0582759045688 0.835175129087 -eN 0.0638098759514 0.835175129087 -eN 0.0698715292681 0.816936360444 -eN 0.0765723466177 0.816936360444 -eN 0.0840634481785 0.834802233854 -eN 0.0925559067242 0.834802233854 -eN 0.102359890227 0.895864893606 -eN 0.113955514927 0.895864893606 -eN 0.128147433837 0.973430248438 -eN 0.146443875886 0.973430248438 -eN 0.172231419495 1.0 -eN 0.216315405154 1.0  > europeanSample/group_${j}_block_${i}.msmc.ceu_8.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < europeanSample/group_${j}_block_${i}.msmc.ceu_8.macs.macsFormat.OutputFile.${rundate}.txt > europeanSample/group_${j}_block_${i}.msmc.ceu_8.macs.msFormat.OutputFile.${rundate}.txt
# MSMC CHB 8-Hap maCS model
# Ancestral size: 5666
NaCHB_8=5666
ri=`bc <<< "${r}*${NaCHB_8}*4"`
./macs 20 100000 -t 0.0002833 -r $ri -eN 0.0 2922.59478534 -eN 0.00144309425987 9797.470534 -eN 0.00293682941276 217.815379918 -eN 0.00448489754582 50.9721582215 -eN 0.00609137901537 27.2875001955 -eN 0.00776090128436 16.0758220215 -eN 0.00949858244679 9.67236051685 -eN 0.0113102112435 5.9631707249 -eN 0.0132024235481 3.76605905243 -eN 0.0151826317727 2.48889956002 -eN 0.0172594837311 1.49554268722 -eN 0.0194428979368 1.49554268722 -eN 0.021744381277 0.926843164198 -eN 0.0241774525792 0.926843164198 -eN 0.0267580661779 0.680591947459 -eN 0.0295053178585 0.680591947459 -eN 0.0324421155038 0.583097109763 -eN 0.0355968733599 0.583097109763 -eN 0.0390037591165 0.518916210765 -eN 0.0427078472982 0.518916210765 -eN 0.0467649074813 0.50902327035 -eN 0.0512497697299 0.50902327035 -eN 0.0562633840365 0.518352302696 -eN 0.0619472921735 0.518352302696 -eN 0.0685090416778 0.559642314411 -eN 0.0762701900426 0.559642314411 -eN 0.0857686665978 0.657781255415 -eN 0.0980143242392 0.657781255415 -eN 0.115273949159 1.0 -eN 0.14477923172 1.0  > asianSample/group_${j}_block_${i}.msmc.chb_8.macs.macsFormat.OutputFile.${rundate}.txt 
./msformatter < asianSample/group_${j}_block_${i}.msmc.chb_8.macs.macsFormat.OutputFile.${rundate}.txt > asianSample/group_${j}_block_${i}.msmc.chb_8.macs.msFormat.OutputFile.${rundate}.txt
done
cd ../
done
